# 一小时总结 -- JVM 虚拟机及问题解决

- 原理性知识
	- 整体：JVM 规范要求
		- 数据类型及字节码
	- 内存管理：JVM 的内存分类及管理方式
		- JVM 的内存分类
		- JVM 的 GC 算法和各 GC 特点；
	- 类加载和管理：
		- JVM 的类加载过程；
		- 双亲委派模型和 classloader
	- 运行过程：
		- JVM 的程序运行过程
		- 线程和栈内存、栈帧本地变量表；
		- 一个对象占用的内存空间如何计算；
	- 效率知识：
		- synchronized 关键字的实现；
		- 偏向锁、自旋锁、轻量级锁和重量级锁；
- 实际应用：
	- JVM 的分类；
	- 对内存分析工具：jmap；
	- 栈分析工具：jstack；
	- 场景：死循环问题定位和分析；
	- 场景：OOM 问题分析；
	- 场景：基于火焰图的性能优化； 

# 原理性知识

## 整体：JVM 规范要求

《Java 虚拟机规范》规定了一个 JVM 的逻辑结构和各结构应该实现的功能；

JVM 规范在下列方面做了实现指导和要求：

- 内存分类：JVM 需要实现 堆内存、栈内存、本地方法区、程序计数器；
	- 内存管理：实现对堆内存的自动化内存管理；
- 类加载和验证：规定某个类应该如何被加载和验证某个是否是合规的 class 文件；
- 字节码：规定了 class 文件的字节码类型以及 JVM 应该如何解析运行字节码指令；
	- 数据类型：规定了每个字节码的对应的数据类型和数据类型转换规则；

## 内存管理：JVM 的内存分类及管理方式

- JVM 及实现的内存可分为线程私有和线程共享的内存；
	- 线程私有的内存：这里的数据不需要加锁没有多线程竞争风险；
	- 线程共有内存：要注意数据是否真的被共享，如线程私有对象但是要放在共享内存中，但是其他线程没有此对象引用是无法访问此对象数据，因此无需同步保护，其他共享内存数据需要注意加锁；
- 线下私有代码：
	- 栈内存：每个线程对应建立一个栈，理论上每次 new 一个 thread 最少要分配 1M 的栈内存空间；
	- 程序计数器：指示当前线程
- 线程共享内存：
	- 堆内存：此内存用来分配 java 对象的实例数据，此内存 JVM 规范要求比必须实现自动化内存管理，即实现 GC ；

### JVM 的 GC 算法和各 GC 特点；

基础算法：
- 根搜索算法：通过

- 标记清楚：
